<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${tour.title + ' | Travelee'}">Tour Detail | Travelee</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/page/css/tour-detail.css}">
</head>
<body>

<!-- Main Content -->
<main class="main-content">
    <div class="tour-detail-container">
        <!-- Tour Header -->
        <div class="tour-header" th:if="${tour != null}">
            <div class="tour-title">
                <h1 th:text="${tour.title != null ? tour.title : 'Tour Title'}">Tour Title</h1>
                <div class="tour-badges">
                    <span th:if="${tour.featured != null and tour.featured}" class="badge featured"><i class="fas fa-star"></i> Nổi bật</span>
                    <span th:if="${tour.isHot != null and tour.isHot}" class="badge hot"><i class="fas fa-fire"></i> Hot</span>
                    <span th:if="${tour.hasPromotion != null and tour.hasPromotion}" class="badge promo"><i class="fas fa-tags"></i> Khuyến mãi</span>
                </div>
            </div>
            <div class="tour-meta">
                <div class="meta-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span th:text="${(tour.departure != null ? tour.departure : '') + ' → ' + (tour.destination != null ? tour.destination : '')}">Route</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span th:text="${tour.duration != null ? tour.duration + ' ngày ' + (tour.duration - 1) + ' đêm' : 'Duration'}">Duration</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-users"></i>
                    <span th:text="${tour.maxParticipants != null ? 'Tối đa ' + tour.maxParticipants + ' khách' : 'Max Participants'}">Max Participants</span>
                </div>
                <div class="meta-item">
                    <span th:class="${'status-badge ' + (tour.status != null and tour.status == 'active' ? 'active' : 'inactive')}" 
                          th:text="${tour.status != null and tour.status == 'active' ? 'Đang mở đặt' : 'Tạm ngưng'}">Status</span>
                </div>
            </div>
        </div>

        <!-- Tour Images -->
        <div class="tour-images" th:if="${tour != null}">
            <div class="main-image">
                <img th:src="${tour.images != null and tour.images.size() > 0 ? tour.images.iterator().next().imageUrl : '/page/imgs/default-tour.jpg'}" 
                     th:alt="${tour.title != null ? tour.title : 'Tour'}" id="mainImage">
                <div class="image-overlay">
                    <button class="btn-prev"><i class="fas fa-chevron-left"></i></button>
                    <button class="btn-next"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="image-thumbnails" th:if="${tour.images != null and tour.images.size() > 0}">
                <div th:each="image, iterStat : ${tour.images}" 
                     th:class="${'thumbnail ' + (iterStat.first ? 'active' : '')}" 
                     th:onclick="'changeImage(' + ${iterStat.index} + ')'">
                    <img th:src="${image.imageUrl}" th:alt="'Tour image ' + ${iterStat.index + 1}">
                </div>
            </div>
        </div>

        <!-- Tour Content -->
        <div class="tour-content" th:if="${tour != null}">
            <div class="content-left">
                <!-- Tour Description -->
                <section class="tour-section">
                    <h2><i class="fas fa-align-left"></i> Mô tả tour</h2>
                    <p class="tour-description" th:text="${tour.description != null ? tour.description : 'Tour description'}">Tour description</p>
                    <div th:if="${tour.highlights != null and tour.highlights != ''}" class="tour-highlights">
                        <h3><i class="fas fa-star"></i> Điểm nổi bật</h3>
                        <div th:utext="${tour.highlights}">Highlights</div>
                    </div>
                </section>

                <!-- Tour Itinerary -->
                <section th:if="${tour.itineraries != null and tour.itineraries.size() > 0}" class="tour-section">
                    <h2><i class="fas fa-route"></i> Lịch trình chi tiết</h2>
                    <div class="itinerary-list">
                        <div th:each="itinerary : ${tour.itineraries}" class="itinerary-day">
                            <div class="day-header">
                                <div class="day-number" th:text="${itinerary.dayNumber != null ? itinerary.dayNumber : '1'}">1</div>
                                <div class="day-info">
                                    <h3 th:text="${itinerary.title != null ? itinerary.title : 'Day Title'}">Day Title</h3>
                                    <div class="day-meta">
                                        <span th:if="${itinerary.meals != null and itinerary.meals != ''}"><i class="fas fa-utensils"></i> <span th:text="${itinerary.meals}">Meals</span></span>
                                        <span th:if="${itinerary.accommodation != null and itinerary.accommodation != ''}"><i class="fas fa-bed"></i> <span th:text="${itinerary.accommodation}">Accommodation</span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="day-content">
                                <div th:if="${itinerary.description != null and itinerary.description != ''}" class="description-content" th:utext="${itinerary.description}"></div>
                                <div th:if="${itinerary.activities != null and itinerary.activities != ''}" class="activities-content" th:utext="${itinerary.activities}"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Tour Includes/Excludes -->
                <section class="tour-section">
                    <div class="includes-excludes">
                        <div th:if="${tour.includes != null and tour.includes != ''}" class="includes">
                            <h3><i class="fas fa-check-circle"></i> Bao gồm</h3>
                            <div class="includes-content" th:utext="${tour.includes}"></div>
                        </div>
                        <div th:if="${tour.excludes != null and tour.excludes != ''}" class="excludes">
                            <h3><i class="fas fa-times-circle"></i> Không bao gồm</h3>
                            <div class="excludes-content" th:utext="${tour.excludes}"></div>
                        </div>
                    </div>
                </section>

                <!-- Tour Terms - Fix cứng theo tour ID -->
                <section class="tour-section">
                    <h2><i class="fas fa-file-contract"></i> Điều khoản & Lưu ý</h2>
                    <div class="tour-terms">
                        <!-- Terms cho tour ID 1 -->
                        <div th:if="${tour.id == 1}" class="term-item">
                            <h4><i class="fas fa-credit-card"></i> Thanh toán</h4>
                            <p>Đặt cọc 50% khi đăng ký tour, thanh toán 100% trước ngày khởi hành 3 ngày.</p>
                        </div>
                        <div th:if="${tour.id == 1}" class="term-item">
                            <h4><i class="fas fa-calendar-times"></i> Hủy tour</h4>
                            <p>Hủy trước 7 ngày: hoàn 100% tiền cọc. Hủy trước 3 ngày: hoàn 50% tiền cọc. Hủy trong vòng 3 ngày: không hoàn tiền.</p>
                        </div>
                        <div th:if="${tour.id == 1}" class="term-item">
                            <h4><i class="fas fa-info-circle"></i> Lưu ý</h4>
                            <p>Mang theo giấy tờ tùy thân, trang phục phù hợp thời tiết, thuốc cá nhân nếu cần.</p>
                        </div>

                        <!-- Terms cho tour ID 2 -->
                        <div th:if="${tour.id == 2}" class="term-item">
                            <h4><i class="fas fa-credit-card"></i> Thanh toán</h4>
                            <p>Đặt cọc 30% khi đăng ký tour, thanh toán 100% trước ngày khởi hành 5 ngày.</p>
                        </div>
                        <div th:if="${tour.id == 2}" class="term-item">
                            <h4><i class="fas fa-calendar-times"></i> Hủy tour</h4>
                            <p>Hủy trước 10 ngày: hoàn 100% tiền cọc. Hủy trước 5 ngày: hoàn 70% tiền cọc. Hủy trong vòng 5 ngày: không hoàn tiền.</p>
                        </div>
                        <div th:if="${tour.id == 2}" class="term-item">
                            <h4><i class="fas fa-info-circle"></i> Lưu ý</h4>
                            <p>Tour phù hợp với mọi lứa tuổi, mang theo áo ấm và giày leo núi.</p>
                        </div>

                        <!-- Terms mặc định cho các tour khác -->
                        <div th:if="${tour.id != 1 and tour.id != 2}" class="term-item">
                            <h4><i class="fas fa-credit-card"></i> Thanh toán</h4>
                            <p>Đặt cọc 40% khi đăng ký tour, thanh toán 100% trước ngày khởi hành 7 ngày.</p>
                        </div>
                        <div th:if="${tour.id != 1 and tour.id != 2}" class="term-item">
                            <h4><i class="fas fa-calendar-times"></i> Hủy tour</h4>
                            <p>Hủy trước 14 ngày: hoàn 100% tiền cọc. Hủy trước 7 ngày: hoàn 60% tiền cọc. Hủy trong vòng 7 ngày: không hoàn tiền.</p>
                        </div>
                        <div th:if="${tour.id != 1 and tour.id != 2}" class="term-item">
                            <h4><i class="fas fa-info-circle"></i> Lưu ý</h4>
                            <p>Vui lòng mang theo giấy tờ tùy thân và trang phục phù hợp với địa điểm tham quan.</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Sidebar -->
            <div class="content-right">
                <!-- Price Card -->
                <div class="price-card">
                    <div class="price-header">
                        <h3>Giá tour</h3>
                        <div th:if="${tour.hasPromotion}" class="price-old" th:text="${#numbers.formatDecimal(tour.adultPrice * 1.1, 0, 'COMMA', 0, 'POINT') + '₫'}">Old Price</div>
                    </div>
                    <div class="price-main">
                        <div class="price-adult">
                            <span class="price-label">Người lớn</span>
                            <span class="price-value" th:text="${#numbers.formatDecimal(tour.adultPrice, 0, 'COMMA', 0, 'POINT') + '₫'}">Adult Price</span>
                        </div>
                        <div class="price-child">
                            <span class="price-label">Trẻ em (5-12 tuổi)</span>
                            <span class="price-value" th:text="${#numbers.formatDecimal(tour.childPrice, 0, 'COMMA', 0, 'POINT') + '₫'}">Child Price</span>
                        </div>
                        <div class="price-infant">
                            <span class="price-label">Trẻ em (dưới 5 tuổi)</span>
                            <span class="price-value">Miễn phí</span>
                        </div>
                    </div>
                    <div th:if="${tour.hasPromotion}" class="price-savings">
                        <i class="fas fa-gift"></i>
                        <span th:text="'Tiết kiệm ' + ${#numbers.formatDecimal(tour.adultPrice * 0.1, 0, 'COMMA', 0, 'POINT') + '₫/người'}">Savings</span>
                    </div>
                    <button class="btn-book-now" onclick="bookTourWithSchedule()" id="bookNowBtn">
                        <i class="fas fa-calendar-check"></i>
                        Đặt tour ngay
                    </button>
                </div>

                <!-- Schedule Card -->
                <div th:if="${tour.schedules.size() > 0}" class="schedule-card">
                    <h3><i class="fas fa-calendar-alt"></i> Lịch khởi hành</h3>
                    <div class="schedule-list">
                        <div th:each="schedule : ${tour.schedules}" class="schedule-item">
                            <div class="schedule-dates">
                                <div class="departure">
                                    <i class="fas fa-plane-departure"></i>
                                    <span th:text="${#temporals.format(schedule.departureDate, 'dd/MM/yyyy')}">Departure Date</span>
                                </div>
                                <div class="return">
                                    <i class="fas fa-plane-arrival"></i>
                                    <span th:text="${#temporals.format(schedule.returnDate, 'dd/MM/yyyy')}">Return Date</span>
                                </div>
                            </div>
                            <div class="schedule-price">
                                <span th:if="${schedule.specialPrice}" class="special-price" 
                                      th:text="${#numbers.formatDecimal(schedule.specialPrice, 0, 'COMMA', 0, 'POINT') + '₫'}">Special Price</span>
                                <span th:unless="${schedule.specialPrice}" class="special-price" 
                                      th:text="${#numbers.formatDecimal(tour.adultPrice, 0, 'COMMA', 0, 'POINT') + '₫'}">Regular Price</span>
                                <span class="slots" th:text="'Còn ' + ${schedule.availableSlots} + ' chỗ'">Available Slots</span>
                            </div>
                            <button class="btn-select-date" 
                                    th:onclick="'selectSchedule(' + ${schedule.id} + ')'"
                                    th:data-schedule-id="${schedule.id}"
                                    th:data-promotional-price="${schedule.specialPrice != null ? schedule.specialPrice : tour.adultPrice}"
                                    th:disabled="${schedule.status == 'full' or schedule.status == 'closed'}">
                                <span th:text="${schedule.status == 'available' ? 'Chọn ngày này' : 
                                               schedule.status == 'limited' ? 'Sắp hết chỗ' : 
                                               schedule.status == 'full' ? 'Đã đầy' : 'Đã đóng'}">Select Date</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Contact Card -->
                <div class="contact-card">
                    <h3><i class="fas fa-headset"></i> Hỗ trợ đặt tour</h3>
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <span class="contact-label">Hotline</span>
                                <span class="contact-value">1900 1234</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <span class="contact-label">Email</span>
                                <span class="contact-value">booking@travelee.vn</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fab fa-facebook-messenger"></i>
                            <div>
                                <span class="contact-label">Messenger</span>
                                <span class="contact-value">Travelee Support</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script th:src="@{/page/js/tour-detail.js}"></script>
</body>
</html>